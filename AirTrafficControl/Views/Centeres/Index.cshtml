
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Ar_Layout.cshtml";
}

@section content{


    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <div class="grad"></div>

        <!-- Content Header (Page header) -->
        <section class="content-header">
            <h1>
المراكـــــز
            </h1>
            <ol class="breadcrumb">
                <li><a href="#"><i class="fa fa-home"></i> نظام المراقبة الجوية </a></li>
                <li class="active"> المراكز</li>
            </ol>

        </section>


        <section class="content" >
            <div class="row">
                <div class="col-xs-12">
                    <div class="box" style="padding-left: 80px;padding-right: 80px;">
                        <div class="box-header">
                            <button type="button" class="btn btn-primary pull-left btn-add" data-toggle="modal" data-target="#add-modal"><i class="fa fa-plus-square">  </i> اضافة جديد </button>
                        </div><!-- /.box-header -->
                        <div class="box-body">
                            <table id="tbx" class="table table-bordered table-hover"></table>
                        </div><!-- /.box-body -->
                    </div><!-- /.box -->
                </div><!-- /.col -->
            </div><!-- /.row -->
        </section>


    </div><!-- /.content-wrapper -->




    <div class="example-modal">
        <div class="modal fade in" id="add-modal">
            <div class="modal-dialog" style="width:80% !important">
                <div class="modal-content">
                    <div class="modal-header .no-border">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title"> إضافة  جديد</h4>
                    </div>
                    <div class="modal-body" >
                        <div class="row">
                            <div class="col-lg-12">
                                <form method="post" id="add-form">
                                    <div class="box .no-border">
                                        <!-- /.box-header -->
                                        <div class="box-body">
                                            <!-- Input addon -->
                                            <div class="row">
                                                <div class="col-lg-12">
                                                    <div class="col-lg-9">
                                                        <div class="form-group">
                                                            <label for="name"> الاســـــم </label>
                                                            <div class="input-group">
                                                                <span class="input-group-addon"><i class="fa fa-home"></i></span>
                                                                <input type="text" class="form-control  name" id="name" name="name" placeholder="الاســــم  " autocomplete="off">
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-lg-3">
                                                        <button type="submit" class="btn btn-primary save" value="save" style="width: 100%;position: relative;top: 25px;">حفظ</button>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                        <!-- /.box-body -->
                                    </div>

                                </form>
                            </div>
                        </div><!-- /.row (main row) -->

                    </div>
                    @*<div class="modal-footer">

                        </div>*@
                </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
        </div><!-- /.modal -->
    </div>




    <!-- Edit Modal -->
    <div class="example-modal">
        <div class="modal fade in" id="edit-modal">
            <div class="modal-dialog" style="width:80% !important">
                <div class="modal-content">
                    <div class="modal-header .no-border">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title">تعديل اسم المركز </h4>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-lg-12">
                                <form method="post" id="edit-form">
                                    <div class="box .no-border">
                                        <!-- /.box-header -->
                                        <div class="box-body">
                                            <!-- Input addon -->
                                            <div class="row">
                                                <div class="col-lg-12">
                                                    <div class="col-lg-9">
                                                        <div class="form-group">
                                                            <label for="ed-name"> الاســـم</label>
                                                            <div class="input-group">
                                                                <span class="input-group-addon"><i class="fa fa-home"></i></span>
                                                                <input id="ed-id" class="ed-id hidden" name="ed-id" />
                                                                <input type="text" class="form-control  edname" id="edname" name="edname" placeholder="القسم " autocomplete="off">
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-lg-3">
                                                        <button type="submit" class="btn btn-primary" value="edit" style="width: 100%;position: relative;top: 25px;">حفظ</button>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                        <!-- /.box-body -->
                                    </div>

                                </form>
                            </div>
                        </div><!-- /.row (main row) -->

                    </div>
                    @*<div class="modal-footer">

                        </div>*@
                </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
        </div><!-- /.modal -->
    </div>





}



@section scripts{

    <script>

     $(function () {


         function loadData() {

             var x = 1;
            var dataTable = $('#tbx').DataTable({
                 "language": {
                     "lengthMenu": "عرض _MENU_ سجل في الصفحة",
                     "search": "بحث"
                 },

                 ajax: {
                     url: '/Centeres/LoadData',
                     dataSrc: ''
                 },

                 columns: [
                     {
                         "title": "#    ",
                         "data": "Id",
                         "visible": false,


                     },
                     {
                         "title": "# ",
                         "data": null,
                         "render": function (data, type, full,meta) {

                             console.log(x);

                             return meta.row + 1;;
                             x = 0;
                         }
                     },

                     {
                         "title": "الاســــم    ",
                         "data": "Name"
                     },


                     {
                         "title": "<i class='fa fa-cog'></i>",
                         "data": null,
                         "width": "20%",
                         "orderable": false,
                         "render": function (data, type,row) {
                             var id = data.Id;
                             var name = data.Name;
                             return  '<div class="btn-opreation">'
                                          + '<button class="btn btn-success transfer" onclick="return openEditModal('+ id + ',' +'\'' + name + '\')">تعديل <i class=" transfer-fa fa  fa-edit"></i></button> '
                                                                           + '<button class="btn btn-danger transfer" onclick=" deleteName(' + id + ',' + '\'' + name + '\')">  مسح   <i class=" transfer-fa fa  fa-delete"></i></button> '


                                 + '</div> '

                             ;

                         }
                     }


                 ]

             });


         }


         loadData();





         $('#add-form').bootstrapValidator({
             onSuccess: function (e) {
                 save();
                 e.preventDefault();

             },
             submitButtons: 'button[type="submit"]',
             feedbackIcons: {
                 valid: 'glyphicon glyphicon-ok success-feedback-icons',
                 invalid: 'glyphicon glyphicon-remove error-feedback-icons',
                 validating: 'fa fa-refresh fa-spin success-feedback-icons'
             },
             fields: {
                 name: {
                     validators: {
                         notEmpty: {
                             message: 'يجب الا يكون حقل الاســــم  فارغ'
                         }
                     }
                 }

             }
         });





     });




     function save() {


         var ob = {
             "Name": $('#name').val()

         };
         $.ajax({
             url: "@Url.Action("Save", "Centeres")",
             type: "POST",
             data: JSON.stringify(ob),
             contentType: "application/json charset=utf-8",
             dataType: "json",
             error: function (response) {
             },
             success: function (response) {
                 toastr[response.Status](response.Message, response.Title);
                 $('#add-form').bootstrapValidator('resetForm', true);

                 $('#add-modal').modal('hide');
                 //dataTable().ajax.reload();
                 $('#tbx').DataTable().ajax.reload();
             }
         });

     }


         //Open Edit Modal
        function openEditModal (id,name) {

            console.log(id);
           console.log(name);
             var currentRow = $(this).closest("tr");

             $('#ed-id').val(id);
             $('#edname').val(name);
             $('#edit-modal').modal('show');

         }


        function deleteName(id,name) {

            Swal.fire({
                title: ' هل متاكد من انك تريد مسح  ' + name,
                // text: "عليك ادخال سبب عدم اكتمال الرحلة",
                // type: "input",
                // html: '<input id="swal-input1"  class="swal2-input" >',//disabled
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'نعــم',
                cancelButtonText: 'لا'
            }).then((result) => {
                var notes = $("#swal-input1").val();

                if (result.isConfirmed) {
                    console.log(notes);
                    console.log(id);
                    deleteNameAjax(id, name);
                }
            })


         };


         function deleteNameAjax(id, name) {
             var ob = {
                 Id: id,
                 Name:name
             }
             $.ajax({
                 url: "@Url.Action("DeleteName", "Centeres")",
                 type: "POST",
             data: JSON.stringify(ob),
             contentType: "application/json charset=utf-8",
             dataType: "json",
             error: function (response) {
                 //toastr[response.Status](response.Message, response.Title);
             },
             success: function (response) {
                 toastr[response.Status](response.Message, response.Title);

                 $('#tbx').DataTable().ajax.reload();


             }
         });
         }





        // Validation And Save Edit Data
         $('#edit-form').bootstrapValidator({
             onSuccess: function (e) {
                 edit();
                 e.preventDefault();

             },
             submitButtons: 'button[type="submit"]',
             feedbackIcons: {
                 valid: 'glyphicon glyphicon-ok success-feedback-icons',
                 invalid: 'glyphicon glyphicon-remove error-feedback-icons',
                 validating: 'fa fa-refresh fa-spin success-feedback-icons'
             },
             fields: {
                 edname: {
                     validators: {
                         notEmpty: {
                             message: 'يجب الا يكون حقل الاسم فارغ'
                         }
                     }
                 },



             }
         });







         function edit() {


             var ob = {
                 "Id": $('#ed-id').val(),
                 "Name": $('#edname').val(),

             };
             $.ajax({
                 url: "@Url.Action("Edit", "Centeres")",
                 type: "POST",
             data: JSON.stringify(ob),
             contentType: "application/json charset=utf-8",
             dataType: "json",
             error: function (response) {
                 //toastr[response.Status](response.Message, response.Title);
             },
             success: function (response) {
                 toastr[response.Status](response.Message, response.Title);
                 $('#edit-form').bootstrapValidator('resetForm', true);


                 $('#edit-modal').modal('hide');
                 // $('#tbx').clear();
                // $("tbody").empty();
                 $('#tbx').DataTable().ajax.reload();
                 //$('#tbx').rows().clear().draw();

                // $('#tbx').DataTable().clear().draw();
                 //location.reload();


             }
         });
         };



    </script>
}






